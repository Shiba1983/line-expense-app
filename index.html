<!DOCTYPE html>
<html>
<head>
    <title>Expense Tracker</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 500px; margin: 0 auto; }
        .box { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        input, button { width: 100%; padding: 10px; margin: 5px 0; }
        button { background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .success { color: green; background: #d4edda; padding: 10px; }
        .error { color: red; background: #f8d7da; padding: 10px; }
    </style>
</head>
<body>
    <h1>Test Participants</h1>
    
    <div class="box">
        <h3>Participants List:</h3>
        <div id="participants">Loading...</div>
    </div>
    
    <div class="box">
        <h3>Add Participant:</h3>
        <input type="text" id="newName" placeholder="Enter name">
        <button onclick="addParticipant()">Add Participant</button>
    </div>
    
    <div class="box">
        <h3>Delete Participant:</h3>
        <input type="text" id="deleteName" placeholder="Enter name to delete">
        <button onclick="deleteParticipant()">Delete Participant</button>
    </div>
    
    <div id="message"></div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycby-qo_RHM3TDBx0jhTNNmYbY9v3N55ls55UX6kG4YqJoOzteFHTiffxU5UUBesomC2aqA/exec';
        
        // Load participants on page load
        loadParticipants();
        
        async function loadParticipants() {
            try {
                const url = API_URL + '?action=getParticipants&t=' + Date.now();
                const res = await fetch(url);
                const data = await res.json();
                
                const div = document.getElementById('participants');
                if (data.success) {
                    if (data.participants.length === 0) {
                        div.innerHTML = 'No participants found.';
                    } else {
                        let html = '<ul>';
                        data.participants.forEach(p => {
                            html += `<li>${p}</li>`;
                        });
                        html += '</ul>';
                        div.innerHTML = html;
                    }
                    showMessage('Loaded ' + data.participants.length + ' participants', 'success');
                } else {
                    div.innerHTML = 'Error: ' + data.error;
                    showMessage('Error: ' + data.error, 'error');
                }
            } catch(e) {
                document.getElementById('participants').innerHTML = 'Network error';
                showMessage('Network error: ' + e.message, 'error');
            }
        }
        
        async function addParticipant() {
            const name = document.getElementById('newName').value.trim();
            if (!name) {
                showMessage('Please enter a name', 'error');
                return;
            }
            
            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'addParticipant', participantName: name })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    document.getElementById('newName').value = '';
                    showMessage(data.message, 'success');
                    loadParticipants(); // Refresh the list
                } else {
                    showMessage('Error: ' + data.error, 'error');
                }
            } catch(e) {
                showMessage('Network error: ' + e.message, 'error');
            }
        }
        
        async function deleteParticipant() {
            const name = document.getElementById('deleteName').value.trim();
            if (!name) {
                showMessage('Please enter a name', 'error');
                return;
            }
            
            if (!confirm('Delete ' + name + '?')) return;
            
            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'deleteParticipant', participantName: name })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    document.getElementById('deleteName').value = '';
                    showMessage(data.message, 'success');
                    loadParticipants(); // Refresh the list
                } else {
                    showMessage('Error: ' + data.error, 'error');
                }
            } catch(e) {
                showMessage('Network error: ' + e.message, 'error');
            }
        }
        
        function showMessage(text, type) {
            const div = document.getElementById('message');
            div.textContent = text;
            div.className = type;
            setTimeout(() => div.textContent = '', 3000);
        }
    </script>
</body>
</html>
