<!DOCTYPE html>
<html>
<head>
    <title>‚úàÔ∏è Expense Splitter - DEBUG</title>
    <meta charset="utf-8">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 500px; margin: 0 auto; }
        .card { background: #f5f5f5; padding: 20px; margin: 10px 0; border-radius: 10px; }
        input, select, button { width: 100%; padding: 10px; margin: 5px 0; }
        button { background: #06c755; color: white; border: none; }
        #debug { background: #333; color: #0f0; padding: 10px; font-family: monospace; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>üí∞ Expense Splitter - DEBUG</h1>
    
    <div class="card">
        <h3>Debug Info</h3>
        <div id="debug">Loading...</div>
    </div>
    
    <div class="card" id="app" style="display:none;">
        <h3>‚ûï Add Expense</h3>
        
        <label>Category:</label>
        <select id="category">
            <option value="Food">Food</option>
            <option value="Transport">Transport</option>
        </select>
        
        <label>Description:</label>
        <input type="text" id="description" placeholder="e.g., Dinner">
        
        <label>Amount:</label>
        <input type="number" id="amount" placeholder="0">
        
        <label>Currency:</label>
        <select id="currency">
            <option value="THB">THB</option>
            <option value="USD">USD</option>
        </select>
        
        <label>Paid By:</label>
        <select id="paidBy">
            <option value="">Loading...</option>
        </select>
        
        <label>Split Between:</label>
        <div id="participantsContainer">
            Loading participants...
        </div>
        
        <button onclick="submitExpense()">Save Expense</button>
        <div id="message"></div>
    </div>

    <script>
        // ========== CONFIGURATION ==========
        // ‚ö†Ô∏è UPDATE THESE ‚ö†Ô∏è
        const API_URL = 'https://script.google.com/macros/s/AKfycby0K0VEU-aLWPLuiQ4k11iBDJK5N8eeliJhx7xmIMZZ-KU2i6wpxQ1diij5NrSbXJczDQ/exec'; // Your Web App URL
        const LIFF_ID = '2008858986-uLQlNN1S'; // Your LIFF ID
        
        let debugLog = [];
        
        function log(msg) {
            debugLog.push(new Date().toLocaleTimeString() + ': ' + msg);
            document.getElementById('debug').innerHTML = debugLog.join('<br>');
            console.log(msg);
        }
        
        // ========== INITIALIZE ==========
        async function init() {
            try {
                log('1. Starting LIFF init...');
                await liff.init({ liffId: LIFF_ID });
                log('‚úÖ LIFF initialized');
                
                if (!liff.isLoggedIn()) {
                    log('Not logged in, redirecting...');
                    liff.login();
                    return;
                }
                
                log('2. Testing API connection...');
                const apiTest = await fetch(API_URL + '?action=test');
                const apiResult = await apiTest.json();
                log('API Test: ' + JSON.stringify(apiResult));
                
                log('3. Loading participants...');
                await loadParticipants();
                
                log('4. Showing app...');
                document.getElementById('app').style.display = 'block';
                
            } catch(error) {
                log('‚ùå ERROR: ' + error.toString());
            }
        }
        
        // ========== LOAD PARTICIPANTS ==========
        async function loadParticipants() {
            try {
                log('Fetching from: ' + API_URL + '?action=getParticipants');
                const response = await fetch(API_URL + '?action=getParticipants');
                log('Response status: ' + response.status);
                
                const data = await response.json();
                log('API Response: ' + JSON.stringify(data));
                
                if (data.participants && data.participants.length > 0) {
                    // Update Paid By dropdown
                    const paidBySelect = document.getElementById('paidBy');
                    paidBySelect.innerHTML = '';
                    data.participants.forEach(person => {
                        const option = document.createElement('option');
                        option.value = person;
                        option.textContent = person;
                        paidBySelect.appendChild(option);
                    });
                    log('‚úÖ Paid By dropdown loaded: ' + data.participants.length + ' options');
                    
                    // Update participants checkboxes
                    const container = document.getElementById('participantsContainer');
                    container.innerHTML = '';
                    data.participants.forEach(person => {
                        const label = document.createElement('label');
                        label.style.display = 'block';
                        label.innerHTML = `
                            <input type="checkbox" value="${person}" checked>
                            ${person}
                        `;
                        container.appendChild(label);
                    });
                    log('‚úÖ Participants checkboxes loaded');
                    
                } else {
                    log('‚ùå No participants found in response');
                }
                
            } catch(error) {
                log('‚ùå Error loading participants: ' + error.toString());
            }
        }
        
        // ========== START ==========
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
